<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF8" />
		<script>
			var defaultconfig = {
				originalhtml: true,
				originaljs: true,
				originalcss: false,
				disablepadding: false,
				usingyoutubemusic: true,
				style: ["./DefaultWidget"],
			};
			var config = {};
			fetch("./config.json")
				.then((res) => res.text())
				.then((text) => {
					config = JSON.parse(text);
					if (config.originalhtml == null || config.originaljs == null || config.originalcss == null || config.disablepadding == null || config.usingyoutubemusic == null || config.style == null) {
						console.error("Something went wrong loading the config, loading default config");
						config = defaultconfig;
					}
				})
				.catch((e) => {
					console.error("Error happened while loading config.json, using default config [" + e + "]");
					config = defaultconfig;
				});

			var body = document.querySelector("body");
			fetch("./tunawidget.html")
				.then((res) => res.text())
				.then((original) => {
					// add tunawidget.html
					var originalhtml = document.createElement("html");
					originalhtml.innerHTML = original;

					// add it's body
					if (config.originalhtml) {
						document.body.innerHTML = originalhtml.querySelector("body").innerHTML;
					}

					// append it's js
					var originaljs = document.createElement("script");
					originaljs.innerHTML = originalhtml.querySelector("script").innerHTML;

					// Youtube music uses cover instead of cover_url
					if (config.usingyoutubemusic) {
						originaljs.innerHTML = originaljs.innerHTML.replace(/cover_url/gm, "cover");
					}

					if (config.disablepadding) {
						document.querySelector(".widget").style = "padding: 0; margin: 0";
					}

					if (config.originaljs) {
						document.head.appendChild(originaljs);
					}

					if (config.originalcss) {
						var originalcss = document.createElement("style");
						originalcss.innerHTML = originalhtml.querySelector("style").innerHTML;
						document.head.appendChild(originalcss);
					}

					// Add load scripts to window to be used globally aka window.WidgetObj.AddCSS/JS/Style()
					(function (window) {
						// Css Load script from my site
						function AddCSS(fileName) {
							var link = document.createElement("link");
							link.type = "text/css";
							link.rel = "stylesheet";
							link.href = fileName;
							document.head.appendChild(link);
						}

						// Css Load modified script from my site
						function AddJS(fileName) {
							var script = document.createElement("script");
							script.type = "text/javascript";
							script.src = fileName;
							document.head.appendChild(script);
						}

						function AddStyle(styleLocation) {
							AddJS(styleLocation + "/index.js");
							AddCSS(styleLocation + "/index.css");
						}

						window.WidgetObj = {
							AddCSS: AddCSS,
							AddJS: AddJS,
							AddStyle: AddStyle,
						};
					})(window);

					config.style.forEach(window.WidgetObj.AddStyle);
				})
				.catch((e) => console.error(e));
		</script>
	</head>
	<body></body>
</html>
